---
name: mcp-router-throttle
description: 默认生效的 MCP 路由与节流规范；在有多个 MCP（GitHub/GitMCP/Zotero/RStudio/Chrome）时，选择最合适的 MCP，先小样本后扩展，输出结构化摘要，并对 GitHub 写操作强制二次确认。
metadata:
  short-description: MCP 路由/节流与确认闸门
---

# MCP 路由/节流（默认策略）

本 skill 用于在多个 MCP 可用时，**选择正确的 MCP**、**控制工具调用与上下文开销**、并通过**确认闸门**降低误操作风险。

## 适用范围（当前纳入）

- `github`：GitHub 平台能力（repo/issue/PR/actions…，含写操作）
- `gitmcp`：公开仓库/Pages 的文档与代码检索（以“查资料、降幻觉”为主）
- `zotero`：本地 Zotero 文献库/批注/语义检索
- `rstudio-mcp`：R 项目/环境/执行（本地）
- `chrome-devtools`：网页读取/交互/截图

如果某个 MCP 未启用或不可用：提示用户在 **cc-switch** 打开该 MCP，并重启 Codex 后再继续。

## 路由规则（先选对，再动手）

1) **Zotero（优先用于“我的文献库”）**
   - 需求关键词：文献检索、条目、标签/集合、BibTeX、PDF 批注、从库里找相似研究。
   - 默认先用：检索/最近/集合/标签 → 需要时再取全文/批注。

2) **GitMCP（优先用于“公共仓库文档/用法/示例”）**
   - 需求关键词：某开源库怎么用、API 用法、文档解释、找示例实现。
   - 默认流程：`fetch_generic_documentation` → `search_generic_documentation`/`search_generic_code` → 必要时 `fetch_generic_url_content`。

3) **GitHub（需要鉴权/私有仓库/Issue&PR/写操作）**
   - 需求关键词：我的/组织仓库、Issue、PR、Actions、release、写文件、开分支、评论。
   - 默认先只读（list/search/get）；**任何写操作必须二次确认**（见“确认闸门”）。

4) **RStudio MCP（需要运行/管理 R 项目与环境）**
   - 需求关键词：运行 R、装包、创建/打开 R 项目、环境管理、输出图/结果。
   - 允许直接执行代码；但涉及删除/覆盖/清理数据时需要确认（见“确认闸门”）。

5) **Chrome DevTools（需要网页证据/抓取/自动化）**
   - 需求关键词：网页内容提取、截图、表单、点击、滚动、抓取页面表格。

## 节流策略（默认：小样本→确认→扩展）

- 列表/搜索类默认只取 **2–5 条**（或前 1 页），并在摘要里注明“可扩展”。
- 需要更多时，先问：**“是否扩展到 N 条/下一页？”**
- 能用“字段子集/最小输出/分页”就不要取全量。
- 文档/全文/批注：先拿摘要或定位片段，只有在确实需要时才取全文。

## 确认闸门（防止误操作）

### GitHub（强制）

在调用任何“写”类工具前（例如创建/更新/删除：issue、PR、分支、文件、触发工作流等）：

1. 先输出“变更预览”，至少包含：
   - 目标 `owner/repo`
   - 将执行的操作（工具名 + 关键参数）
   - 影响范围（文件/分支/issue/PR 编号等）
2. 明确询问：**“确认执行 GitHub 写操作吗？（是/否）”**
3. 仅在用户明确回答“是/确认/继续”后才执行。

### RStudio MCP（仅删除/覆盖前确认）

执行会删除/覆盖/清理的操作前必须确认；运行分析代码、读取信息、列环境/包可以直接做。

## 默认输出（结构化摘要）

每次完成后输出一段简短摘要：

- `路由结果`：本次选择了哪些 MCP（以及原因）
- `工具调用`：调用了哪些工具、各自返回了多少条（样本大小）
- `证据/来源`：关键结果的来源（仓库路径、文献条目 key、URL 等）
- `下一步`：是否需要扩展到更多条/更深层获取；以及是否触发确认闸门
